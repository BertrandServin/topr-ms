e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=FALSE)
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4")
grid.arrange(e1,p1,ncol=2)
snps2plot %>% select(CHROM,POS,ref,alt,ID,Gene_Symbol,MAF,P1,E1,P2,E2) %>% arrange(P1)
library(cowplot)
install.packages(cowplot)
install.packages("cowplot")
library("cowplot")
plot_grid(e1,p1,ncol=2,rel_widths = 1/2,1/2)
plot_grid(e1,p1,ncol=2,nrow=1rel_widths = 1/2,1/2)
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = 1/2,1/2)
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = 1/4,1/2)
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = 1/4,3/4)
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = c(1,2))
grid.arrange(e1,p1,ncol=2)
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = c(1,2))
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = c(0.7,1))
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = c(0.7,1.2))
plot_grid(e1,p1,ncol=2,nrow=1,rel_widths = c(0.7,1))
grid_arrange_shared_legend <- function(...) {
plots <- list(...)
g <- ggplotGrob(plots[[1]] + theme(legend.position="top"))$grobs
legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
lheight <- sum(legend$height)
grid.arrange(
do.call(arrangeGrob, lapply(plots, function(x)
x + theme(legend.position="none"))),
legend,
ncol = 1,
heights = unit.c(unit(1, "npc") - lheight, lheight))
}
grid_arrange_shared_legend(e1,p1,ncol=2)
grid_arrange_shared_legend <- function(...) {
plots <- list(...)
g <- ggplotGrob(plots[[1]] + theme(legend.position="top"))$grobs
legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
lheight <- sum(legend$height)
grid.arrange(
do.call(arrangeGrob, lapply(plots, function(x)
x + theme(legend.position="none"))),
legend,
ncol = 2,
heights = unit.c(unit(1, "npc") - lheight, lheight))
}
grid_arrange_shared_legend(e1,p1,ncol=2)
library(gridExtra)
get_legend<-function(myggplot){
tmp <- ggplot_gtable(ggplot_build(myggplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)
}
grid.arrange(e1, p1, legend, ncol=3, widths=c(2.3, 2.3, 0.8))
grid.arrange(e1, p1, legend, ncol=3, widths=c(2.3, 2.3, 0.8))
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4")
legend <- get_legend(p1)
p1 <- p1 + theme(legend.position="none")
grid.arrange(e1, p1, legend, ncol=3, widths=c(2.3, 2.3, 0.8))
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4",hide_legend=TRUE)
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4",hide_legend=TRUE)
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4",hide_legend=TRUE)
grid.arrange(e1, p1, get_legend(p1), ncol=3, widths=c(2.3, 2.3, 0.8))
grid.arrange(e1, p1, get_legend(p1), ncol=3, widths=c(2.3, 2.3, 0.8))
legend=get_legend(p1)
legend=get_legend(p1)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4",hide_legend=FALSE)
legend=get_legend(p1)
grid.arrange(e1, p1, get_legend(p1), ncol=3, widths=c(2.3, 2.3, 0.8))
p1=log10_plot(snps2plot, "Anstee", "Finngen v4",hide_legend=TRUE)
legend=get_legend(p1)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
e1=effect_plot(snps2plot, pheno_x="Anstee", pheno_y="Finngen v4",hide_legend=TRUE)
p1=log10_plot(snps2plot, "Anstee", "Finngen v4")
grid.arrange(e1, p1, get_legend(p1), ncol=3, widths=c(2.3, 2.3, 0.8))
grid.arrange(e1, p1+theme(legend.position = "none"), get_legend(p1), ncol=3, widths=c(2.3, 2.3, 0.8))
snps2plot=snps2plot %>% distinct(CHROM,POS, .keep_all = TRUE)
snps2plot
snps2plot %>% select(CHROM,POS,ref,alt,ID,Gene_Symbol,MAF,P1,E1,P2,E2) %>% arrange(P1)
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor")
colnames(dat4meta)
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename P_anstee P1 | rename OR_anstee OR1 | rename P_finngen P2 | rename E_finngen E2 | rename variant_id ID |
select CHROM,POS,ID,conservative_AF,Gene_Symbol,P1,OR,P2,E2")
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename P_anstee P1 | rename OR_anstee OR | rename P_finngen P2 | rename E_finngen E2 | rename variant_id ID |
select CHROM,POS,ID,conservative_AF,Gene_Symbol,P1,OR,P2,E2")
dat4meta$E1=log(dat4meta$OR)
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |
select CHROM,POS,ID,conservative_AF,Gene_Symbol,SE1,OR,SE2,E2")
dat4meta$E1=log(dat4meta$OR)
library(meta)
run_meta=function(dat, n=2){
results=data.frame(CHROM=as.character(),POS=as.integer(),ID=as.character(),gene=as.character(),stats.fixed=as.double(),stats.random=as.double(),pval=as.double(),tau2=as.double(),I2=as.double())
for(i in 1:nrow(dat)){ #nrow(dat)){ #length(dat$POS)){
if(n==2) inputdat=data.frame(TE=c(as.numeric(dat[i,"E1"]), as.numeric(dat[i,"E2"])),seTE=c(as.numeric(dat[i,"SE1"]), as.numeric(dat[i,"SE2"])))
else if(n == 3)inputdat=data.frame(TE=c(as.numeric(dat[i,"E1"]), as.numeric(dat[i,"E2"]),as.numeric(dat[i,"E3"])),seTE=c(as.numeric(dat[i,"SE1"]), as.numeric(dat[i,"SE2"]),as.numeric(dat[i,"SE3"]) ))
res=metagen(TE,seTE,data=inputdat)
lower_tail=ifelse(res$statistic.fixed > 0, FALSE, TRUE)
pval=pnorm(res$statistic.fixed,lower.tail=lower_tail)
row=data.frame(dat[i,"CHROM"],dat[i,"POS"],dat[i,"ID"],dat[i,"Gene_Symbol"],res$statistic.fixed,res$statistic.random,pval,res$tau2,res$I2)
results=rbind(results, row)
if(i %% 100==0) {
print(i)
}
}
return(results)
}
meta_results=run_meta(dat4meta)
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
manhattan(meta_results2)
manhattan(meta_results)
head(meta_results)
manhattan(list(gwas_anstee_2020,meta_results))
manhattan(list(gwas_anstee_2020,gwas_finngen,meta_results),legend_labels=c("Anstee","Finngen v4","Meta"))
manhattan(list(gwas_anstee_2020,gwas_finngen,meta_results),alpha=c(1,0.7,0.3),size=c(1.2,1,1.4),legend_labels=c("Anstee","Finngen v4","Meta"))
manhattan(list(meta_results,gwas_anstee_2020,gwas_finngen),alpha=c(1,0.7,0.3),size=c(1.4,1,0.8),legend_labels=c("Anstee","Finngen v4","Meta"))
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen),alpha=c(1,0.7,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8),legend_labels=c("Meta","Anstee","Finngen v4"))
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4),alpha=c(1,0.7,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8),legend_labels=c("Meta","Anstee","Finngen v4"))
meta_results %>% kable(“html”, digits=16) %>%as.character() %>% display_html()
library("kable")
library("kableExtra")
install.packages(“kableExtra”)
install.packages("kableExtra")
library("kableExtra")
meta_results %>% kable(“html”, digits=16) %>%as.character() %>% display_html()
meta_results %>% kable("html", digits=16) %>%as.character() %>% display_html()
library("IRdisplay")
meta_results %>% kable("html", digits=16) %>%as.character() %>% display_html()
head(meta_results)
get_best_snp_per_MB(meta_results)
get_best_snp_per_MB(meta_results)
get_best_snp_per_MB=function(df,thresh=1e-09,region=1000000){
if(! "CHROM" %in% colnames(df) || (! "POS" %in% colnames(df)) || (! "P" %in% colnames(df))){
if(is.data.frame(dat)) dat=list(df)
dat=dat_column_check_and_set(dat)
dat=dat_chr_check(dat)
df=dat[[1]]
}
df$CHROM=gsub("chr","", df$CHROM)
df=df %>% filter(P<thresh)
df$tmp=NA
for(row in 1:nrow(df)){
df$tmp=round(df$POS/region)
}
lead_snps=df %>% group_by(CHROM,tmp) %>% arrange(P) %>% filter(P== min(P))
if(length(lead_snps)== 0){
print(paste("There are no SNPs with a p-value below ",thresh, " in the input. Use the [thresh] argument to adjust the threshold.",sep=""))
}
return(ungroup(lead_snps)%>% distinct(CHROM,POS, .keep_all = T))
}
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4),alpha=c(1,0.7,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8),legend_labels=c("Meta","Anstee","Finngen v4"))
meta_results=run_meta(dat4meta)
dat4meta$E1=log(dat4meta$OR)
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4),alpha=c(1,0.7,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8),legend_labels=c("Meta","Anstee","Finngen v4"))
get_best_snp_per_MB(meta_results)
get_best_snp_per_MB=function(df,thresh=1e-09,region=1000000){
if(! "CHROM" %in% colnames(df) || (! "POS" %in% colnames(df)) || (! "P" %in% colnames(df))){
if(is.data.frame(df)) dat=list(df)
dat=dat_column_check_and_set(dat)
dat=dat_chr_check(dat)
df=dat[[1]]
}
df$CHROM=gsub("chr","", df$CHROM)
df=df %>% filter(P<thresh)
df$tmp=NA
for(row in 1:nrow(df)){
df$tmp=round(df$POS/region)
}
lead_snps=df %>% group_by(CHROM,tmp) %>% arrange(P) %>% filter(P== min(P))
if(length(lead_snps)== 0){
print(paste("There are no SNPs with a p-value below ",thresh, " in the input. Use the [thresh] argument to adjust the threshold.",sep=""))
}
return(ungroup(lead_snps)%>% distinct(CHROM,POS, .keep_all = T))
}
get_best_snp_per_MB(meta_results)
get_best_snp_per_MB(meta_results,thresh=1e-08)
meta_hits=get_best_snp_per_MB(meta_results,thresh=1e-08)
colnames(dat4meta)
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2")
inner_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
dat4meta$E1=log(dat4meta$OR)
inner_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
merge(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
meta_hits=get_best_snp_per_MB(meta_results,thresh=1e-08)
meta_hits
merge(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
outer_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
left_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
right_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
inner_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
left_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
left_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2) %>% distinct(ID,.keep_all = TRUE),  by="ID")
dat4meta=dat4meta %>% distinct(CHROM,POS,.keep_all=TRUE)
left_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2),  by="ID")
## META analysis of Finngen and Anstee
dat4meta_ionis=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
dat4meta_ionis$E1=log(dat4meta_ionis$OR)
dat4meta_ionis=dat4meta_ionis %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta_ionis,n=3)
#FINNGEN v4
ionis_file="user_data/analysis_runs/liver_eur_anc_ff_v2_mac20flag_29032021/gwas/plink_NASH_NAFL_EUR_nashbioHTF_adjBMIpc10_annotated.gorz"
gwas_ionis=query("pgor user_data/thorhildur/public_data/finngen_651_cases_176148_ctrls_p0.05.gor| where pval<1e-03 ")
gwas_ionis=query("pgor user_data/thorhildur/public_data/finngen_651_cases_176148_ctrls_p0.05.gor| where P<1e-03 ")
#echo $GOR_API_KEY
api_key="eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjZThiMGJkMS1hNTE5LTQ0YWEtYTZlYy1kNTYyYmM5MWU0NmUifQ.eyJpYXQiOjE2MTg1ODUwNTIsImp0aSI6ImU5NzY1YTljLWFmYjItNDdlOC1iOGY1LWM0MGNiZTJlMTk3MSIsImlzcyI6Imh0dHBzOi8vY29sbGFiLmdlbnVpdHlzY2kuY29tL2F1dGgvcmVhbG1zL3d1eGluZXh0Y29kZS5jb20iLCJhdWQiOiJodHRwczovL2NvbGxhYi5nZW51aXR5c2NpLmNvbS9hdXRoL3JlYWxtcy93dXhpbmV4dGNvZGUuY29tIiwic3ViIjoiM2QxNjA3ZDktZmM2ZS00NjQwLTkxMTYtN2JhYjM0YWEwNzljIiwidHlwIjoiT2ZmbGluZSIsImF6cCI6Imp1cHl0ZXJodWIiLCJzZXNzaW9uX3N0YXRlIjoiYzViMDYyYmYtZjBjNS00ZTYxLTgwNGUtMGRkNjhkZjIzMzMyIiwic2NvcGUiOiJlbWFpbCBwcm9maWxlIG9mZmxpbmVfYWNjZXNzIn0.yPVQa3vRw9k2_Z4gIO2iRmtFmrHhnMo-fQx3kB5Mwjo"
project="amelia"
conn <- gor_connect(api_key, project)
query <- gor_create(conn = conn)
#ANSTEE replication data
anstee_2020_file="user_data/thorhildur/public_data/GCST90011885_buildGRCh37_hg38_updated_VEP.gorz"
#FINNGEN v4
ionis_file="user_data/analysis_runs/liver_eur_anc_ff_v2_mac20flag_29032021/gwas/plink_NASH_NAFL_EUR_nashbioHTF_adjBMIpc10_annotated.gorz"
gwas_ionis=query("pgor user_data/thorhildur/public_data/finngen_651_cases_176148_ctrls_p0.05.gor| where P<1e-03 ")
gwas_ionis=query("pgor user_data/analysis_runs/liver_eur_anc_ff_v2_mac20flag_29032021/gwas/plink_NASH_NAFL_EUR_nashbioHTF_adjBMIpc10_annotated.gorz | where P<1e-03 ")
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
manhattan(list(meta_results %>% filter(pval<1e-3),ntop=4,gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),ntop=4,alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
left_join(meta_hits, dat4meta %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
meta_hits=get_best_snp_per_MB(meta_results,thresh=1e-08)
colnames(meta_hits)
colnames(dat4meta)
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
left_join(meta_hits, dat4meta_ionis %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
dat4meta_ionis$E1=log(dat4meta_ionis$OR)
dat4meta_ionis=dat4meta_ionis %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta_ionis,n=3)
manhattan(list(meta_results %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),ntop=4,alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
meta_hits=get_best_snp_per_MB(meta_results,thresh=1e-08)
left_join(meta_hits, dat4meta_ionis %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis_NASH=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis_NASH.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH=dat4meta_ionis_NASH %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH=run_meta(dat4meta_ionis_NASH,n=3)
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH$E1=log(dat4meta_ionis_NASH$OR)
dat4meta_ionis_NASH=dat4meta_ionis_NASH %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH=run_meta(dat4meta_ionis_NASH,n=3)
manhattan(list(meta_results_NASH %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),ntop=4,alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
meta_hits=get_best_snp_per_MB(meta_results,thresh=1e-08)
left_join(meta_hits, dat4meta_ionis_NASH %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
meta_hits=get_best_snp_per_MB(meta_results,thresh=5e-08)
left_join(meta_hits, dat4meta_ionis_NASH %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
meta_hits=get_best_snp_per_MB(meta_results_NASH,thresh=1e-08)
left_join(meta_hits, dat4meta_ionis_NASH %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
## META analysis of Finngen,Anstee and Ionis biopsy
dat4meta_ionis_NASH_biopsy=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis_NASH_biopsy.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH_biopsy$E1=log(dat4meta_ionis_NASH_biopsy$OR)
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH_biopsy$E1=log(dat4meta_ionis_NASH_biopsy$OR)
dat4meta_ionis_NASH_biopsy=dat4meta_ionis_NASH_biopsy %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH_biopsy=run_meta(dat4meta_ionis_NASH_biopsy,n=3)
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH_biopsy$E1=log(dat4meta_ionis_NASH_biopsy$OR)
dat4meta_ionis_NASH_biopsy=dat4meta_ionis_NASH_biopsy %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH_biopsy=run_meta(dat4meta_ionis_NASH_biopsy,n=3)
manhattan(list(meta_results_NASH_biopsy %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),ntop=4,alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
meta_hits=get_best_snp_per_MB(meta_results_NASH_biopsy,thresh=1e-08)
left_join(meta_hits, dat4meta_ionis_NASH %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
left_join(meta_hits %>% select(-tmp), dat4meta_ionis_NASH %>% select(ID,AF,P_anstee,E1,P_finngen,E2,P_ionis,E3),  by="ID")
outdir="/Users/thorhildur/work/genuityscience/ionis/meta_results"
outdir="/Users/thorhildur/work/genuityscience/ionis/meta_results/"
outdir="/Users/thorhildur/work/genuityscience/ionis/meta_results"
write.table(dat4meta_ionis_NASH_biopsy, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NASH_biopsy.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(dat4meta_ionis_NASH, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NASH.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2")
dat4meta$E1=log(dat4meta$OR)
dat4meta=dat4meta %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta)
write.table(dat4meta, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
dat4meta_ionis$E1=log(dat4meta_ionis$OR)
dat4meta_ionis=dat4meta_ionis %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta_ionis,n=3)
write.table(dat4meta_ionis, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis NAFL
dat4meta_ionis_NAFL=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis_NAFL.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NAFL$E1=log(dat4meta_ionis_NAFL$OR)
dat4meta_ionis_NAFL=dat4meta_ionis_NAFL %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NAFL=run_meta(dat4meta_ionis_NAFL,n=3)
write.table(dat4meta_ionis_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
manhattan(list(meta_results_NAFL %>% filter(pval<1e-3),gwas_anstee_2020,gwas_finngen_v4,gwas_ionis),ntop=4,alpha=c(1,0.7,0.3,0.3),highlight_genes=known_genes,size=c(1.2,1,0.8,0.5),legend_labels=c("Meta","Anstee","Finngen v4","Ionis"))
write.table(meta_results, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_reusults_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_results, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2")
dat4meta$E1=log(dat4meta$OR)
dat4meta=dat4meta %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta)
write.table(meta_results, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
dat4meta_ionis$E1=log(dat4meta_ionis$OR)
dat4meta_ionis=dat4meta_ionis %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_ionis=run_meta(dat4meta_ionis,n=3)
write.table(meta_results_ionis, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_results_NASH, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NASH.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_results_NASH_biopsy, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NASH_biopsy.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_reusults_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis NAFL
dat4meta_ionis_NAFL=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_ionis_NAFL.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NAFL$E1=log(dat4meta_ionis_NAFL$OR)
dat4meta_ionis_NAFL=dat4meta_ionis_NAFL %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NAFL=run_meta(dat4meta_ionis_NAFL,n=3)
write.table(meta_reusults_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
write.table(meta_results_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
library(gorr)
setwd("/Users/thorhildur/IdeaProjects/topR")
source("/Users/thorhildur/IdeaProjects/topR/assoc_plots_v1.R")
#The input data
gwas_cd=read.table(file="/testdata/EUR.CD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
#The input data
gwas_cd=read.table(file="testdata/EUR.CD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
head(gwas_cd)
length(gwas_cd$pos)
#The input data
gwas_CD=read.table(file="testdata/EUR.CD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
#The input data
gwas_CD=read.table(file="testdata/EUR.CD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
gwas_UC=read.table(file="testdata/EUR.UC.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
gwas_IBD=read.table(file="testdata/EUR.IBD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38.gor", as.is=T,header=T)
length(gwas_UC$pos)
length(gwas_IBD$pos)
print(collapse, "Number of SNPs per dataset: ",length(gwas_CD$pos),length(gwas_UC$pos),length(gwas_IBD$pos)))
print(collapse, "Number of SNPs per dataset: ",length(gwas_CD$pos),length(gwas_UC$pos),length(gwas_IBD$pos))
print(paste, "Number of SNPs per dataset, CD: [ ",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos))
print(paste, "Number of SNPs per dataset, CD: [ ",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep=""))
print(paste, "Number of SNPs per dataset, CD: [ ",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep="")
paste("Number of SNPs per dataset, CD: [ ",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep="")
paste("Number of SNPs per dataset, CD: [",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep="")
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
manhattan(gwas_CD)
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
manhattan(gwas_CD)
#Get the input data
gwas_CD=read.table(file="testdata/EUR.CD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38_filt.gor", as.is=T,header=T)
gwas_UC=read.table(file="testdata/EUR.UC.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38_filt.gor", as.is=T,header=T)
gwas_IBD=read.table(file="testdata/EUR.IBD.gwas_info03_filtered.assoc.cutoff_p1e_03_hg38_filt.gor", as.is=T,header=T)
#Start by checking how many variants are in the datasets, since we do not want to plot with too many datapoints
paste("Number of SNPs per dataset, CD: [",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep="")
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
manhattan(gwas_CD)
dev.off()
manhattan(gwas_CD)
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
manhattan(gwas_CD %>% filter(P<1e-5))
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
manhattan(gwas_CD %>% filter(P<1e-4))
manhattan(list(gwas_CD,gwas_UC))
manhattan(gwas_CD)
#Start by checking how many variants are in the datasets, since we do not want to plot with too many datapoints
paste("Number of SNPs per dataset, CD: [",length(gwas_CD$pos),"], UC: [",length(gwas_UC$pos),"], IBD: [", length(gwas_IBD$pos), "]", sep="")
#Get an overview of the crohn's disease (CD) results in a Manhattan plot
# TODO: grunsamlega lengi að plotta allt gagnasettið sem er 44206 varíantar
gwas_CD_filt=gwas_CD %>% filter(P<1e-05)
manhattan(gwas_CD_filt)
# View the CD and the UC results together on one manhattan plot
manhattan(list(gwas_CD,gwas_UC))
# View the CD, UC and IBD results together on one manhattan plot
manhattan(list(gwas_CD,gwas_UC,gwas_IBD))
#label the top variants
snps_CD=get_best_snp_per_MB(gwas_CD_filt,thresh = 1e-15)
manhattan(gwas_CD_filt, variants=snps_CD)
#label the top variants
snps_CD=get_best_snp_per_MB(gwas_CD_filt,thresh = 1e-20)
manhattan(gwas_CD_filt, variants=snps_CD)
#label the top variants
snps_CD=get_best_snp_per_MB(gwas_CD_filt,thresh = 1e-20, region = 10000000)
manhattan(gwas_CD_filt, variants=snps_CD)
# View the CD, UC and IBD results together on one manhattan plot
manhattan(list(gwas_CD,gwas_UC,gwas_IBD))
#Improved version of the same plot
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),ntop=2)
#Improved version of the same plot
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1))
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1))
#Add gene names to the plot for the top variants
snps_UC=get_best_snp_per_MB(gwas_UC,thresh = 1e-20, region = 10000000)
snps_IBD=get_best_snp_per_MB(gwas_IBD,thresh = 1e-20, region = 10000000)
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1))
#Add gene names to the plot for the top variants
snps_UC=get_best_snp_per_MB(gwas_UC,thresh = 1e-15, region = 10000000)
snps_IBD=get_best_snp_per_MB(gwas_IBD,thresh = 1e-20, region = 10000000)
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1))
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1))
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1),title="Overview of IBD datasets")
manhattan(list(gwas_CD,gwas_UC,gwas_IBD),variants=list(snps_CD,snps_UC,snps_IBD),ntop=2,legend_labels = c("CD","UC","IBD"), alpha=c(1,0.5,1),title="IBD association results")
manhattan(gwas_CD_filt, variants=snps_CD)
manhattan(gwas_CD_filt)
library(gorr)
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
source("/Users/thorhildur/IdeaProjects/topR/assoc_plots_v1.R")
source("/Users/thorhildur/IdeaProjects/Rscripts/effect_plot.R")
outdir="/Users/thorhildur/work/genuityscience/ionis/meta_results"
#echo $GOR_API_KEY
api_key="eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjZThiMGJkMS1hNTE5LTQ0YWEtYTZlYy1kNTYyYmM5MWU0NmUifQ.eyJpYXQiOjE2MTg1ODUwNTIsImp0aSI6ImU5NzY1YTljLWFmYjItNDdlOC1iOGY1LWM0MGNiZTJlMTk3MSIsImlzcyI6Imh0dHBzOi8vY29sbGFiLmdlbnVpdHlzY2kuY29tL2F1dGgvcmVhbG1zL3d1eGluZXh0Y29kZS5jb20iLCJhdWQiOiJodHRwczovL2NvbGxhYi5nZW51aXR5c2NpLmNvbS9hdXRoL3JlYWxtcy93dXhpbmV4dGNvZGUuY29tIiwic3ViIjoiM2QxNjA3ZDktZmM2ZS00NjQwLTkxMTYtN2JhYjM0YWEwNzljIiwidHlwIjoiT2ZmbGluZSIsImF6cCI6Imp1cHl0ZXJodWIiLCJzZXNzaW9uX3N0YXRlIjoiYzViMDYyYmYtZjBjNS00ZTYxLTgwNGUtMGRkNjhkZjIzMzMyIiwic2NvcGUiOiJlbWFpbCBwcm9maWxlIG9mZmxpbmVfYWNjZXNzIn0.yPVQa3vRw9k2_Z4gIO2iRmtFmrHhnMo-fQx3kB5Mwjo"
project="amelia"
conn <- gor_connect(api_key, project)
query <- gor_create(conn = conn)
#ANSTEE replication data
anstee_2020_file="user_data/thorhildur/public_data/GCST90011885_buildGRCh37_hg38_updated_VEP.gorz"
gwas_anstee_2020=query(paste("pgor ",anstee_2020_file," | where P<1e-03 | rename variant_id ID ",sep=""))
#FINNGEN v5
finngen_5_file="user_data/thorhildur/public_data/NAFLD_finngen_894_cases_217898_ctrls_p0.001.gor"
gwas_finngen_v4=query("pgor user_data/thorhildur/public_data/NAFLD_finngen_894_cases_217898_ctrls_p0.001.gor | where pval<1e-03 | rename chrom CHROM | rename pos POS | rename pval P| rename rsid ID")
library("meta")
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2")
dat4meta$E1=log(dat4meta$OR)
dat4meta=dat4meta %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta)
## META analysis of Finngen and Anstee
dat4meta=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2")
dat4meta$E1=log(dat4meta$OR)
dat4meta=dat4meta %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results=run_meta(dat4meta)
write.table(meta_results, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_v5.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5_ionis.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
dat4meta_ionis$E1=log(dat4meta_ionis$OR)
dat4meta_ionis=dat4meta_ionis %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_ionis=run_meta(dat4meta_ionis,n=3)
write.table(meta_results_ionis, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_v5_ionis.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis
dat4meta_ionis_NASH=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5_ionis_NASH.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH$E1=log(dat4meta_ionis_NASH$OR)
dat4meta_ionis_NASH=dat4meta_ionis_NASH %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH=run_meta(dat4meta_ionis_NASH,n=3)
write.table(meta_results_NASH, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_v5_ionis_NASH.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
## META analysis of Finngen,Anstee and Ionis biopsy
dat4meta_ionis_NASH_biopsy=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5_ionis_NASH_biopsy.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH_biopsy$E1=log(dat4meta_ionis_NASH_biopsy$OR)
dat4meta_ionis_NASH_biopsy=dat4meta_ionis_NASH_biopsy %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH_biopsy=run_meta(dat4meta_ionis_NASH_biopsy,n=3)
## META analysis of Finngen,Anstee and Ionis NAFL
dat4meta_ionis_NAFL=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5_ionis_NAFL.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NAFL$E1=log(dat4meta_ionis_NAFL$OR)
dat4meta_ionis_NAFL=dat4meta_ionis_NAFL %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NAFL=run_meta(dat4meta_ionis_NAFL,n=3)
write.table(meta_results_NAFL, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_v5_ionis_NAFL.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
outdir
## META analysis of Finngen,Anstee and Ionis biopsy
dat4meta_ionis_NASH_biopsy=query("gor user_data/thorhildur/datcomp/anstee_p1e_03_overlap_finngen_v5_ionis_NASH_biopsy.gor | rename SE_anstee SE1 | rename OR_anstee OR | rename SE_finngen SE2 | rename E_finngen E2 | rename variant_id ID |rename conservative_AF AF|rename SE_ionis SE3 | rename E_ionis E3 |
select CHROM,POS,ID,AF,Gene_Symbol,P_anstee,SE1,OR,P_finngen,SE2,E2,SE3,E3,P_ionis")
# pvalues and heterogenity of meta analysis
dat4meta_ionis_NASH_biopsy$E1=log(dat4meta_ionis_NASH_biopsy$OR)
dat4meta_ionis_NASH_biopsy=dat4meta_ionis_NASH_biopsy %>% distinct(CHROM,POS,.keep_all=TRUE)
meta_results_NASH_biopsy=run_meta(dat4meta_ionis_NASH_biopsy,n=3)
write.table(meta_results_NASH_biopsy, file=paste(outdir,"meta_anstee_p1e_03_overlap_finngen_v5_ionis_NASH_biopsy.gor",sep="/"), quote=FALSE,row.names = F,col.names = T,sep="\t")
